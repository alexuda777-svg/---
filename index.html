<!DOCTYPE html>
<html lang="ru">
<head>
    <!-- –í–µ—Å—å head –æ—Å—Ç–∞–µ—Ç—Å—è –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè∞ –¢–∞–π–Ω–∞ –ü—Ä–æ–∫–ª—è—Ç–æ–≥–æ –ó–∞–º–∫–∞ ‚Äî –≠–ø–∏–∫ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π</title>
    <style>
        /* –í–µ—Å—å CSS –æ—Å—Ç–∞–µ—Ç—Å—è –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô */
        *{margin:0;padding:0;box-sizing:border-box}
        body{background:linear-gradient(45deg,#1a0033,#000011);color:#e0e0ff;font-family:'Courier New',monospace;padding:20px;min-height:100vh}
        .container{max-width:1000px;margin:0 auto}
        .header{text-align:center;background:linear-gradient(90deg,#aa00ff,#00ffff,#44ff44);-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-size:2.2em;margin:20px 0;text-shadow:0 0 30px #aa00ff55;animation:glow 3s infinite alternate}
        @keyframes glow{0%{filter:drop-shadow(0 0 10px #aa00ff)}100%{filter:drop-shadow(0 0 20px #00ffff)}}
        .status-bar{background:rgba(0,20,60,0.95);border:2px solid #44aaff;border-radius:15px;padding:15px;margin:20px 0;display:grid;grid-template-columns:2fr 1fr 1fr 1fr 1fr;gap:10px}
        .stat{text-align:center;font-size:0.9em}
        .hp{color:#ff4444;font-size:1.3em;font-weight:bold}
        .strength{color:#ffaa00} .magic{color:#aa44ff} .gold{color:#ffd700} .level{color:#00ff88}
        .scene{background:rgba(10,10,25,0.95);border:2px solid #666;border-radius:20px;padding:30px;min-height:450px;margin:20px 0;box-shadow:0 0 40px rgba(170,0,255,0.2)}
        .scene-text{line-height:1.6;font-size:1.1em;min-height:200px}
        .typing-cursor::after{content:'|';animation:blink 1s infinite}
        @keyframes blink{0%,50%{opacity:1}51%,100%{opacity:0}}
        .highlight{background:rgba(255,255,0,0.2);padding:4px 8px;border-radius:6px;color:#ffdd44;font-weight:bold}
        .danger{color:#ff6666} .success{color:#44ff44} .magic-text{color:#aa44ff;text-shadow:0 0 10px #aa44ff}
        .legendary{color:#ffaa00;text-shadow:0 0 15px #ffaa00}
        .choices{display:flex;flex-direction:column;gap:10px}
        .choice-btn{background:linear-gradient(135deg,#667eea,#764ba2,#f093fb);color:white;border:none;padding:18px;font-size:1.1em;border-radius:12px;cursor:pointer;transition:all .3s;box-shadow:0 8px 25px rgba(0,0,0,0.4);width:100%}
        .choice-btn:hover{transform:translateY(-3px);box-shadow:0 12px 35px rgba(102,126,234,0.6)}
        .choice-btn:disabled{opacity:0.5;transform:none!important;cursor:not-allowed}
        .next-game-btn{background:linear-gradient(135deg,#ff6b6b,#feca57,#ff9ff3,#54a0ff);color:#000;font-weight:bold;font-size:1.3em;padding:25px;border:3px solid #ffd700;box-shadow:0 10px 40px rgba(255,215,0,0.5);animation:pulse 2s infinite}
        @keyframes pulse{0%,100%{box-shadow:0 10px 40px rgba(255,215,0,0.5)}50%{box-shadow:0 15px 50px rgba(255,215,0,0.8)}}
        .next-game-btn:hover{transform:translateY(-5px);box-shadow:0 20px 60px rgba(255,215,0,0.7)}
        .inventory{background:rgba(0,50,20,0.9);border:2px solid #44aa44;border-radius:12px;padding:15px;margin:15px 0;display:flex;flex-wrap:wrap;gap:10px}
        .item{background:linear-gradient(45deg,#44aa44,#88dd88);color:#000;padding:8px 15px;border-radius:20px;font-weight:bold;font-size:0.9em}
        .battle-log{background:rgba(80,0,0,0.95);border:2px solid #ff4444;border-radius:12px;padding:20px;margin:15px 0;max-height:250px;overflow-y:auto;font-family:monospace;font-size:0.95em}
        .victory{background:linear-gradient(45deg,#44ff44,#00ff88)!important;color:#000!important}
        .defeat{background:linear-gradient(45deg,#ff4444,#ff8888)!important;color:#000!important}
        @media(max-width:600px){.status-bar{grid-template-columns:1fr}}
    </style>
</head>
<body>
    <!-- HTML –æ—Å—Ç–∞–µ—Ç—Å—è –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô -->
    <div class="container">
        <h1 class="header" id="title">üè∞ –¢–ê–ô–ù–ê –ü–†–û–ö–õ–Ø–¢–û–ì–û –ó–ê–ú–ö–ê</h1>
        <div class="status-bar">
            <div class="stat"><div>‚öîÔ∏è <span id="player-name">–ì–µ—Ä–æ–π</span></div><div class="hp" id="hp">150/200</div></div>
            <div class="stat"><div>üí™ –°–∏–ª–∞</div><div class="strength" id="strength">100</div></div>
            <div class="stat"><div>‚ú® –ú–∞–≥–∏—è</div><div class="magic" id="magic">50</div></div>
            <div class="stat"><div>ü™ô –ó–æ–ª–æ—Ç–æ</div><div class="gold" id="gold">150</div></div>
            <div class="stat"><div>‚≠ê –£—Ä–æ–≤–µ–Ω—å</div><div class="level" id="level">1</div></div>
        </div>
        <div class="scene">
            <div class="scene-text typing-cursor" id="scene-text">üîÆ –ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <div class="inventory" id="inventory" style="display:none"></div>
        </div>
        <div class="choices" id="choices"></div>
        <div class="battle-log" id="battle-log" style="display:none"></div>
    </div>

    <script>
        let gameState = {
            player: {name: prompt('üîÆ –ò–º—è –≥–µ—Ä–æ—è:') || '–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –¢–µ–Ω–µ–≥–æ–π', hp: 150, maxHp: 200, strength: 100, magic: 50, gold: 150, level: 1, inventory: [], keys: 0, hasAmulet: false},
            currentRoom: 'intro_promise',
            isBattling: false, battleEnemy: null, plotProgress: 0,
            defeatedFinalBoss: false,
            typingTimeout: null, battleTimeouts: []
        };

        // ‚úÖ –ì–õ–ê–í–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï - –ü–†–Ø–ú–ê–Ø –û–ë–†–ê–ë–û–¢–ö–ê –ö–ù–û–ü–ö–ò –í handleChoice
        function handleChoice(choice) {
            document.getElementById('choices').innerHTML = '';
            
            // ‚úÖ –°–ü–ï–¶–ò–ê–õ–¨–ù–ê–Ø –û–ë–†–ê–ë–û–¢–ö–ê –ö–ù–û–ü–ö–ò –°–õ–ï–î–£–Æ–©–ï–ô –ò–ì–†–´
            if (choice.next === null && choice.isNextGame) {
                window.open('https://alexuda777-svg.github.io/-.github.io-game-perevertysh-/', '_blank');
                document.getElementById('scene-text').innerHTML = 'üöÄ <span class="success">–ù–æ–≤–∞—è –∏–≥—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞ –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ!</span><br>üéÆ –ù–∞—Å–ª–∞–∂–¥–∞–π—Å—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–π!';
                return;
            }
            
            if (choice.cost && gameState.player.gold >= choice.cost) {
                gameState.player.gold -= choice.cost;
                if (choice.effect) {
                    if (choice.effect.strength) gameState.player.strength += choice.effect.strength;
                    if (choice.effect.magic) gameState.player.magic += choice.effect.magic;
                    if (choice.effect.hp) gameState.player.hp = Math.min(gameState.player.maxHp, gameState.player.hp + choice.effect.hp);
                    if (choice.effect.item) gameState.player.inventory.push(choice.effect.item);
                }
                updateUI();
                showScene(gameState.currentRoom);
                return;
            }
            if (choice.next) {
                gameState.currentRoom = choice.next;
                showScene(gameState.currentRoom);
            }
        }

        // –í–°–ï –û–°–¢–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô (updateUI, typeText, showScene, showChoices, startBattle, performBattleRound, finishBattle)
        function updateUI() {
            document.getElementById('player-name').textContent = gameState.player.name;
            document.getElementById('hp').textContent = `${gameState.player.hp}/${gameState.player.maxHp}`;
            document.getElementById('strength').textContent = gameState.player.strength;
            document.getElementById('magic').textContent = gameState.player.magic;
            document.getElementById('gold').textContent = gameState.player.gold;
            document.getElementById('level').textContent = gameState.player.level;
            document.getElementById('title').textContent = `üè∞ –¢–ê–ô–ù–ê –ó–ê–ú–ö–ê | ${gameState.player.name} | –£—Ä.${gameState.player.level}`;
        }

        function typeText(element, text, speed = 50) {
            let i = 0;
            element.classList.add('typing-cursor');
            function type() {
                if (i < text.length) {
                    element.textContent = text.substring(0, i + 1);
                    i++;
                    gameState.typingTimeout = setTimeout(type, speed);
                } else {
                    element.classList.remove('typing-cursor');
                }
            }
            clearTimeout(gameState.typingTimeout);
            type();
        }

        function showScene(room) {
            const scene = gameWorld[room];
            if (!scene) {
                console.error('–ö–æ–º–Ω–∞—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞:', room);
                return showScene('intro_promise');
            }
            
            clearTimeout(gameState.typingTimeout);
            typeText(document.getElementById('scene-text'), scene.text.join(' '));
            
            if (scene.onEnter) setTimeout(() => scene.onEnter(), 2000);
            
            const inv = document.getElementById('inventory');
            if (gameState.player.inventory.length > 0) {
                inv.innerHTML = gameState.player.inventory.map(item => `<span class="item">${item}</span>`).join('');
                inv.style.display = 'flex';
            } else inv.style.display = 'none';
            
            setTimeout(() => showChoices(scene.choices), 2500);
            updateUI();
        }

        function showChoices(choices) {
            const choicesEl = document.getElementById('choices');
            choicesEl.innerHTML = '';
            choices.forEach((choice, index) => {
                const btn = document.createElement('button');
                btn.className = 'choice-btn';
                
                // ‚úÖ –°–ü–ï–¶–ò–ê–õ–¨–ù–´–ô –°–¢–ò–õ–¨ –î–õ–Ø –ö–ù–û–ü–ö–ò –°–õ–ï–î–£–Æ–©–ï–ô –ò–ì–†–´
                if (choice.isNextGame) {
                    btn.className = 'choice-btn next-game-btn';
                }
                
                btn.textContent = choice.text;
                btn.disabled = choice.condition && !choice.condition();
                btn.onclick = () => handleChoice(choice);
                choicesEl.appendChild(btn);
            });
        }

        function startBattle(enemyName, enemyHp, enemyStr, rewardRoom) {
            gameState.isBattling = true;
            gameState.battleEnemy = { name: enemyName, hp: enemyHp, maxHp: enemyHp, strength: enemyStr, rewardRoom };
            
            clearTimeout(gameState.typingTimeout);
            gameState.battleTimeouts.forEach(id => clearTimeout(id));
            gameState.battleTimeouts = [];
            
            document.getElementById('battle-log').style.display = 'block';
            document.getElementById('battle-log').className = 'battle-log';
            document.getElementById('battle-log').innerHTML = `<div>‚öîÔ∏è –ë–ò–¢–í–ê: ${gameState.player.name} VS ${enemyName}</div>`;
            document.getElementById('choices').innerHTML = '';
            
            performBattleRound();
        }

        function performBattleRound() {
            if (!gameState.isBattling || !gameState.battleEnemy) return;
            
            const log = document.getElementById('battle-log');
            
            const playerDmg = Math.max(5, gameState.player.strength - Math.floor(Math.random() * 20));
            gameState.battleEnemy.hp -= playerDmg;
            log.innerHTML += `<div>‚öîÔ∏è ${gameState.player.name} –Ω–∞–Ω–µ—Å <span class="highlight">${playerDmg}</span> [${Math.max(0, gameState.battleEnemy.hp)}/${gameState.battleEnemy.maxHp}]</div>`;
            
            if (gameState.battleEnemy.hp <= 0) {
                log.innerHTML += `<div class="success">üéâ <span class="highlight">–ü–û–ë–ï–î–ê!</span> +80 –∑–æ–ª–æ—Ç–∞</div>`;
                if (gameState.battleEnemy.name === '–ö–æ—Ä–æ–ª—å –õ–∏—á') {
                    gameState.defeatedFinalBoss = true;
                }
                gameState.battleTimeouts.push(setTimeout(() => finishBattle(gameState.battleEnemy.rewardRoom), 2000));
                return;
            }
            
            const enemyDmg = Math.max(3, gameState.battleEnemy.strength - Math.floor(Math.random() * 25));
            gameState.player.hp -= enemyDmg;
            log.innerHTML += `<div>üíÄ ${gameState.battleEnemy.name} –Ω–∞–Ω–µ—Å <span class="highlight">${enemyDmg}</span> [${Math.max(0, gameState.player.hp)}/${gameState.player.maxHp}]</div>`;
            
            if (gameState.player.hp <= 0) {
                log.innerHTML += `<div class="danger">üíÄ <span class="highlight">–ü–û–†–ê–ñ–ï–ù–ò–ï!</span></div>`;
                log.className = 'battle-log defeat';
                gameState.battleTimeouts.push(setTimeout(() => {
                    document.getElementById('choices').innerHTML = '<button class="choice-btn" onclick="location.reload()">üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>';
                }, 2000));
                gameState.isBattling = false;
                return;
            }
            
            gameState.battleTimeouts.push(setTimeout(performBattleRound, 1500));
        }

        function finishBattle(nextRoom) {
            gameState.isBattling = false;
            gameState.battleEnemy = null;
            gameState.battleTimeouts.forEach(id => clearTimeout(id));
            gameState.battleTimeouts = [];
            
            gameState.player.gold += 80;
            document.getElementById('battle-log').style.display = 'none';
            
            gameState.currentRoom = nextRoom;
            showScene(nextRoom);
        }

        // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ò–ù–û–í–ù–ê–Ø –ö–û–ú–ù–ê–¢–ê
        const gameWorld = {
            intro_promise: {
                text: ["üéÆ <span class='legendary'>–¢—ã –ø–æ–ª—É—á–∏—à—å –µ—â–µ –æ–¥–Ω—É —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—É—é –∏–≥—Ä—É, –µ—Å–ª–∏ –ø–æ–±–µ–¥–∏—à—å –≥–ª–∞–≤–Ω–æ–≥–æ –∑–ª–æ–¥–µ—è!</span>", 
                       "üè∞ –ì–æ—Ç–æ–≤—å—Å—è –∫ —ç–ø–∏—á–µ—Å–∫–æ–π –±–∏—Ç–≤–µ —Å –ö–æ—Ä–æ–ª–µ–º –õ–∏—á–µ–º!", 
                       "–ü–æ–±–µ–¥–∏—à—å ‚Äî –æ—Ç–∫—Ä–æ—é —Å–µ–∫—Ä–µ—Ç–Ω—É—é –¥–≤–µ—Ä—å –≤ –Ω–æ–≤—É—é –∏–≥—Ä—É..."],
                choices: [
                    {text: "‚öîÔ∏è –ù–∞—á–∞—Ç—å –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ!", next: 'intro'},
                    {text: "üõí –ú–∞–≥–∞–∑–∏–Ω —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏", next: 'shop'}
                ]
            },
            // ... –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã —Ç–æ—á–Ω–æ —Ç–∞–∫–∏–µ –∂–µ ...
            intro: {
                text: ["üåô –ù–æ—á—å 13-–≥–æ. –ì—Ä–æ–∑–∞ –Ω–∞–¥ –ü—Ä–æ–∫–ª—è—Ç—ã–º –ó–∞–º–∫–æ–º.", "–¢—ã ‚Äî –ù–∞—Å–ª–µ–¥–Ω–∏–∫ –¢–µ–Ω–µ–≥–æ–π. –û—Ç–µ—Ü –ø—Ä–æ–ø–∞–ª –∑–¥–µ—Å—å 13 –ª–µ—Ç –Ω–∞–∑–∞–¥.", "–í–µ—Ç–µ—Ä —à–µ–ø—á–µ—Ç: '–ö—Ä–æ–≤—å –∑–æ–≤–µ—Ç –∫—Ä–æ–≤—å...'"],
                choices: [
                    {text: "‚öîÔ∏è –í–æ—Ä–≤–∞—Ç—å—Å—è —Å –±–æ–µ–º", next: 'hallway_bold'},
                    {text: "üïØÔ∏è –û—Å—Ç–æ—Ä–æ–∂–Ω–æ –≤–æ–π—Ç–∏", next: 'hallway_cautious'},
                    {text: "üõí –ú–∞–≥–∞–∑–∏–Ω", next: 'shop'}
                ]
            },
            hallway_bold: {
                text: ["‚öîÔ∏è –¢—ã –≤—Ä—ã–≤–∞–µ—à—å—Å—è –≤ –≥–ª–∞–≤–Ω—ã–π –∑–∞–ª!", "üíÄ –¢—Ä–∏ —Å–∫–µ–ª–µ—Ç–∞-—Å—Ç—Ä–∞–∂–∞ –æ–∂–∏–≤–∞—é—Ç!"],
                onEnter: () => startBattle('–°–∫–µ–ª–µ—Ç—ã-—Å—Ç—Ä–∞–∂–∏', 90, 18, 'hallway_victory'),
                choices: []
            },
            hallway_victory: {
                text: ["üèÜ –°–∫–µ–ª–µ—Ç—ã –ø–æ–≤–µ—Ä–∂–µ–Ω—ã!", "üíé –ù–∞—Ö–æ–¥–∏—à—å –ö–ª—é—á —Å—Ç—Ä–∞–∂–∏!", "–î–≤–µ –¥–æ—Ä–æ–≥–∏ –≤–µ–¥—É—Ç –≥–ª—É–±–∂–µ –≤ –∑–∞–º–æ–∫..."],
                onEnter: () => { gameState.player.keys++; gameState.plotProgress = 1; },
                choices: [
                    {text: "‚û°Ô∏è –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞", next: 'library'},
                    {text: "üî® –ö—É–∑–Ω–∏—Ü–∞", next: 'forge'},
                    {text: "üõí –ú–∞–≥–∞–∑–∏–Ω", next: 'shop'}
                ]
            },
            hallway_cautious: {
                text: ["üïØÔ∏è –¢—ã –∫—Ä–∞–¥—ë—à—å—Å—è... –Ω–∞—Ö–æ–¥–∏—à—å –ö–∏–Ω–∂–∞–ª –∞—Å—Å–∞—Å–∏–Ω–∞ (+25 —Å–∏–ª—ã)!", "üí∞ +75 –∑–æ–ª–æ—Ç–∞"],
                onEnter: () => { gameState.player.inventory.push('–ö–∏–Ω–∂–∞–ª –∞—Å—Å–∞—Å–∏–Ω–∞'); gameState.player.strength += 25; gameState.player.gold += 75; },
                choices: [{text: "‚û°Ô∏è –ì–ª–∞–≤–Ω—ã–π –∑–∞–ª", next: 'hallway_victory'}, {text: "üõí –ú–∞–≥–∞–∑–∏–Ω", next: 'shop'}]
            },
            library: {
                text: ["üìö –î—Ä–µ–≤–Ω—è—è –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞.", "üíÄ –ü—Ä–∏–∑—Ä–∞—á–Ω—ã–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä—å –æ—Ö—Ä–∞–Ω—è–µ—Ç –°–≤–∏—Ç–æ–∫ –ø—Ä–æ—Ä–æ—á–µ—Å—Ç–≤!"],
                choices: [
                    {text: "‚öîÔ∏è –°—Ä–∞–∑–∏—Ç—å—Å—è —Å –ø—Ä–∏–∑—Ä–∞–∫–æ–º", next: 'ghost_fight'},
                    {text: "üîô –ù–∞–∑–∞–¥", next: 'hallway_victory'}
                ]
            },
            ghost_fight: {
                text: ["üëª –ü—Ä–∏–∑—Ä–∞–∫ —Ä–µ–≤—ë—Ç! –ù—É–∂–Ω–∞ –º–∞–≥–∏—è!"],
                onEnter: () => startBattle('–ü—Ä–∏–∑—Ä–∞–∫', 110, 22, 'library_victory'),
                choices: []
            },
            library_victory: {
                text: ["üèÜ –ü—Ä–∏–∑—Ä–∞–∫ –∏–∑–≥–Ω–∞–Ω!", "üìú –ß–∏—Ç–∞–µ—à—å –ü—Ä–æ—Ä–æ—á–µ—Å—Ç–≤–æ: '–¢—Ä–∏ –ö–ª—é—á–∞ + –ê–º—É–ª–µ—Ç –æ—Ç–∫—Ä–æ—é—Ç –ø—É—Ç—å –∫ –ß–µ—Ä–Ω–æ–º—É —Ç—Ä–æ–Ω—É...'"],
                onEnter: () => { gameState.plotProgress = 3; gameState.player.magic += 15; },
                choices: [{text: "‚û°Ô∏è –ê–ª—Ç–∞—Ä–Ω–∞—è", next: 'altar'}, {text: "üîô –ù–∞–∑–∞–¥", next: 'hallway_victory'}]
            },
            forge: {
                text: ["üî® –ö—É–∑–Ω–∏—Ü–∞ –î–≤–∞—Ä—Ñ–æ–≤.", "üëπ –û–≥—Ä-–∫—É–∑–Ω–µ—Ü –æ—Ö—Ä–∞–Ω—è–µ—Ç –†—É–Ω–Ω—ã–π –º–æ–ª–æ—Ç!"],
                choices: [
                    {text: "‚öîÔ∏è –°—Ä–∞–∑–∏—Ç—å—Å—è —Å –æ–≥—Ä–æ–º", next: 'ogre_fight'},
                    {text: "üîô –ù–∞–∑–∞–¥", next: 'hallway_victory'}
                ]
            },
            ogre_fight: {
                text: ["üëπ –û–≥—Ä-–∫—É–∑–Ω–µ—Ü –±–µ—Å–∏—Ç—Å—è!"],
                onEnter: () => startBattle('–û–≥—Ä-–∫—É–∑–Ω–µ—Ü', 140, 28, 'forge_victory'),
                choices: []
            },
            forge_victory: {
                text: ["üèÜ –û–≥—Ä –ø–æ–≤–µ—Ä–∂–µ–Ω!", "üî® –ë–µ—Ä–µ—à—å –†—É–Ω–Ω—ã–π –º–æ–ª–æ—Ç (+40 —Å–∏–ª—ã)"],
                onEnter: () => { gameState.player.inventory.push('–†—É–Ω–Ω—ã–π –º–æ–ª–æ—Ç'); gameState.player.strength += 40; },
                choices: [{text: "‚û°Ô∏è –ü–æ–¥–∑–µ–º–µ–ª—å–µ", next: 'dungeon'}, {text: "üîô –ù–∞–∑–∞–¥", next: 'hallway_victory'}]
            },
            altar: {
                text: ["‚õ™ –ó–∞–ø—Ä–µ—Ç–Ω–∞—è –ê–ª—Ç–∞—Ä–Ω–∞—è.", "üîë –ù—É–∂–µ–Ω –ö–ª—é—á —Å—Ç—Ä–∞–∂–∏ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏!"],
                choices: [
                    {text: "üîë –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∞–ª—Ç–∞—Ä—å", condition: () => gameState.player.keys >= 1, next: 'altar_active'},
                    {text: "üîô –ù–∞–∑–∞–¥", next: 'library_victory'}
                ]
            },
            altar_active: {
                text: ["‚ú® –ê–ª—Ç–∞—Ä—å –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!", "üíé –ü–æ–ª—É—á–∞–µ—à—å –ê–º—É–ª–µ—Ç –ü—Ä–µ–¥–∫–æ–≤! +50 –∫–æ –≤—Å–µ–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º!"],
                onEnter: () => { 
                    gameState.player.hasAmulet = true; 
                    gameState.player.strength += 50; 
                    gameState.player.magic += 50; 
                    gameState.player.keys += 2;
                },
                choices: [{text: "üëë –ö –ß–µ—Ä–Ω–æ–º—É –¢—Ä–æ–Ω—É", next: 'final_chamber'}]
            },
            final_chamber: {
                text: ["üëë –ß–ï–†–ù–´–ô –¢–†–û–ù", `–ö–ª—é—á–∏: ${gameState.player.keys} | –ê–º—É–ª–µ—Ç: ${gameState.player.hasAmulet ? '‚úì' : '‚úó'}`],
                choices: [
                    {text: "‚öîÔ∏è –§–∏–Ω–∞–ª—å–Ω—ã–π –ë–æ—Å—Å", condition: () => gameState.player.keys >= 3 && gameState.player.hasAmulet, next: 'final_boss'},
                    {text: "üîô –ù–∞–∑–∞–¥", next: 'altar_active'}
                ]
            },
            final_boss: {
                text: ["‚ò†Ô∏è –ö–æ—Ä–æ–ª—å –õ–∏—á –≤–æ—Å—Å—Ç–∞–µ—Ç!", "‚öîÔ∏è –≠–ü–ò–§–ê–ù–ò–Ø –ë–ò–¢–í–ê!"],
                onEnter: () => startBattle('–ö–æ—Ä–æ–ª—å –õ–∏—á', 300, 45, 'victory'),
                choices: []
            },
            victory: {
                text: ["üéâ <span class='legendary'>–õ–ï–ì–ï–ù–î–ê –°–û–í–ï–†–®–ï–ù–ê!</span>", "‚ò†Ô∏è –ö–æ—Ä–æ–ª—å –õ–∏—á –ø–æ–≤–µ—Ä–∂–µ–Ω!", "üëë –¢—ã ‚Äî –Ω–æ–≤—ã–π –ö–æ—Ä–æ–ª—å –ó–∞–º–∫–∞!", 
                       `<span class="magic-text">‚ú® <b>–ù–ê–ñ–ú–ò –ö–ù–û–ü–ö–£ –ù–ò–ñ–ï –î–õ–Ø –°–õ–ï–î–£–Æ–©–ï–ô –ò–ì–†–´!</b></span>`],
                choices: [
                    {text: "üéÆ –ò–ì–†–ê–¢–¨ –°–õ–ï–î–£–Æ–©–£–Æ –ò–ì–†–£ ‚û°Ô∏è", isNextGame: true, next: null}, // ‚úÖ –°–ü–ï–¶–ò–ê–õ–¨–ù–´–ô –§–õ–ê–ì
                    {text: "üîÑ –ù–û–í–ê–Ø –ò–ì–†–ê", next: 'intro_promise'}
                ]
            },
            shop: {
                text: ["üõí –¢–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –¢–æ—Ä–≥–æ–≤–µ—Ü:", "üíé '–í—ã–±–µ—Ä–∏ –º–æ—â—å, –≥–µ—Ä–æ–π...'"],
                choices: [
                    {text: "üó°Ô∏è –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –∫–ª–∏–Ω–æ–∫ (250 –∑–æ–ª.) +50 —Å–∏–ª—ã", next: 'shop', cost: 250, effect: {strength: 50, item: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –∫–ª–∏–Ω–æ–∫'}},
                    {text: "‚ú® –ü–æ—Å–æ—Ö –∞—Ä—Ö–∏–º–∞–≥–∞ (200 –∑–æ–ª.) +60 –º–∞–≥–∏–∏", next: 'shop', cost: 200, effect: {magic: 60, item: '–ü–æ—Å–æ—Ö –∞—Ä—Ö–∏–º–∞–≥–∞'}},
                    {text: "‚û°Ô∏è –í –∑–∞–º–æ–∫", next: 'intro_promise'}
                ]
            },
            dungeon: {
                text: ["üï≥Ô∏è –¢–µ–º–Ω–æ–µ –ü–æ–¥–∑–µ–º–µ–ª—å–µ. –°–ª–∏—à–∫–æ–º –æ–ø–∞—Å–Ω–æ –ø–æ–∫–∞...", "–í–µ—Ä–Ω–∏—Å—å –ø–æ–∑–∂–µ —Å –±–æ–ª—å—à–µ–π —Å–∏–ª–æ–π!"],
                choices: [{text: "üîô –ù–∞–∑–∞–¥", next: 'hallway_victory'}]
            }
        };

        updateUI();
        showScene('intro_promise');
    </script>
</body>
</html>
