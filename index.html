<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè∞ –¢–∞–π–Ω–∞ –ü—Ä–æ–∫–ª—è—Ç–æ–≥–æ –ó–∞–º–∫–∞ ‚Äî –≠–ø–∏–∫ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{background:linear-gradient(45deg,#1a0033,#000011);color:#e0e0ff;font-family:'Courier New',monospace;padding:20px;min-height:100vh}
        .container{max-width:1000px;margin:0 auto}
        .header{text-align:center;background:linear-gradient(90deg,#aa00ff,#00ffff,#44ff44);-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-size:2.2em;margin:20px 0;text-shadow:0 0 30px #aa00ff55;animation:glow 3s infinite alternate}
        @keyframes glow{0%{filter:drop-shadow(0 0 10px #aa00ff)}100%{filter:drop-shadow(0 0 20px #00ffff)}}
        .status-bar{background:rgba(0,20,60,0.95);border:2px solid #44aaff;border-radius:15px;padding:15px;margin:20px 0;display:grid;grid-template-columns:2fr 1fr 1fr 1fr 1fr;gap:10px}
        .stat{text-align:center;font-size:0.9em}
        .hp{color:#ff4444;font-size:1.3em;font-weight:bold}
        .strength{color:#ffaa00} .magic{color:#aa44ff} .gold{color:#ffd700} .level{color:#00ff88}
        .scene{background:rgba(10,10,25,0.95);border:2px solid #666;border-radius:20px;padding:30px;min-height:450px;margin:20px 0;box-shadow:0 0 40px rgba(170,0,255,0.2)}
        .scene-text{line-height:1.6;font-size:1.1em;min-height:200px}
        .typing-cursor::after{content:'|';animation:blink 1s infinite}
        @keyframes blink{0%,50%{opacity:1}51%,100%{opacity:0}}
        .highlight{background:rgba(255,255,0,0.2);padding:4px 8px;border-radius:6px;color:#ffdd44;font-weight:bold}
        .danger{color:#ff6666} .success{color:#44ff44} .magic-text{color:#aa44ff;text-shadow:0 0 10px #aa44ff}
        .legendary{color:#ffaa00;text-shadow:0 0 15px #ffaa00}
        .choices{display:flex;flex-direction:column;gap:10px}
        .choice-btn{background:linear-gradient(135deg,#667eea,#764ba2,#f093fb);color:white;border:none;padding:18px;font-size:1.1em;border-radius:12px;cursor:pointer;transition:all .3s;box-shadow:0 8px 25px rgba(0,0,0,0.4);width:100%}
        .choice-btn:hover{transform:translateY(-3px);box-shadow:0 12px 35px rgba(102,126,234,0.6)}
        .choice-btn:disabled{opacity:0.5;transform:none!important;cursor:not-allowed}
        .inventory{background:rgba(0,50,20,0.9);border:2px solid #44aa44;border-radius:12px;padding:15px;margin:15px 0;display:flex;flex-wrap:wrap;gap:10px}
        .item{background:linear-gradient(45deg,#44aa44,#88dd88);color:#000;padding:8px 15px;border-radius:20px;font-weight:bold;font-size:0.9em}
        .battle-log{background:rgba(80,0,0,0.95);border:2px solid #ff4444;border-radius:12px;padding:20px;margin:15px 0;max-height:250px;overflow-y:auto;font-family:monospace;font-size:0.95em}
        .victory{background:linear-gradient(45deg,#44ff44,#00ff88)!important;color:#000!important}
        .defeat{background:linear-gradient(45deg,#ff4444,#ff8888)!important;color:#000!important}
        @media(max-width:600px){.status-bar{grid-template-columns:1fr}}
    </style>
</head>
<body>
    <div class="container">
        <h1 class="header" id="title">üè∞ –¢–ê–ô–ù–ê –ü–†–û–ö–õ–Ø–¢–û–ì–û –ó–ê–ú–ö–ê</h1>
        <div class="status-bar">
            <div class="stat"><div>‚öîÔ∏è <span id="player-name">–ì–µ—Ä–æ–π</span></div><div class="hp" id="hp">150/200</div></div>
            <div class="stat"><div>üí™ –°–∏–ª–∞</div><div class="strength" id="strength">100</div></div>
            <div class="stat"><div>‚ú® –ú–∞–≥–∏—è</div><div class="magic" id="magic">50</div></div>
            <div class="stat"><div>ü™ô –ó–æ–ª–æ—Ç–æ</div><div class="gold" id="gold">150</div></div>
            <div class="stat"><div>‚≠ê –£—Ä–æ–≤–µ–Ω—å</div><div class="level" id="level">1</div></div>
        </div>
        <div class="scene">
            <div class="scene-text typing-cursor" id="scene-text">üîÆ –ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <div class="inventory" id="inventory" style="display:none"></div>
        </div>
        <div class="choices" id="choices"></div>
        <div class="battle-log" id="battle-log" style="display:none"></div>
    </div>

    <script>
        let gameState = {
            player: {name: prompt('üîÆ –ò–º—è –≥–µ—Ä–æ—è:') || '–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –¢–µ–Ω–µ–≥–æ–π', hp: 150, maxHp: 200, strength: 100, magic: 50, gold: 150, level: 1, inventory: [], keys: 0, hasAmulet: false},
            currentRoom: 'intro', isBattling: false, battleEnemy: null, plotProgress: 0, finalBossDefeated: false,
            typingTimeout: null, battleTimeouts: []
        };

        function updateUI() {
            document.getElementById('player-name').textContent = gameState.player.name;
            document.getElementById('hp').textContent = `${gameState.player.hp}/${gameState.player.maxHp}`;
            document.getElementById('strength').textContent = gameState.player.strength;
            document.getElementById('magic').textContent = gameState.player.magic;
            document.getElementById('gold').textContent = gameState.player.gold;
            document.getElementById('level').textContent = gameState.player.level;
            document.getElementById('title').textContent = `üè∞ –¢–ê–ô–ù–ê –ó–ê–ú–ö–ê | ${gameState.player.name} | –£—Ä.${gameState.player.level}`;
        }

        // üî• –ê–ù–ò–ú–ê–¶–ò–Ø –ü–ï–ß–ê–¢–ö–ò –¢–ï–ö–°–¢–ê
        function typeText(element, text, speed = 50) {
            let i = 0;
            element.classList.add('typing-cursor');
            function type() {
                if (i < text.length) {
                    element.textContent = text.substring(0, i + 1);
                    i++;
                    gameState.typingTimeout = setTimeout(type, speed);
                } else {
                    element.classList.remove('typing-cursor');
                }
            }
            clearTimeout(gameState.typingTimeout);
            type();
        }

        function showScene(room) {
            const scene = gameWorld[room];
            if (!scene) return showScene('intro');
            
            // –û—á–∏—â–∞–µ–º —Ç–∞–π–º–∞—É—Ç—ã
            clearTimeout(gameState.typingTimeout);
            
            // –ê–Ω–∏–º–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞
            typeText(document.getElementById('scene-text'), scene.text.join(' '));
            
            if (scene.onEnter) setTimeout(() => scene.onEnter(), 2000);
            
            const inv = document.getElementById('inventory');
            if (gameState.player.inventory.length > 0) {
                inv.innerHTML = gameState.player.inventory.map(item => `<span class="item">${item}</span>`).join('');
                inv.style.display = 'flex';
            } else inv.style.display = 'none';
            
            setTimeout(() => showChoices(scene.choices), 2500);
            updateUI();
        }

        function showChoices(choices) {
            const choicesEl = document.getElementById('choices');
            choicesEl.innerHTML = '';
            choices.forEach(choice => {
                const btn = document.createElement('button');
                btn.className = 'choice-btn';
                btn.textContent = choice.text;
                btn.disabled = choice.condition && !choice.condition();
                btn.onclick = () => handleChoice(choice);
                choicesEl.appendChild(btn);
            });
        }

        function handleChoice(choice) {
            document.getElementById('choices').innerHTML = '';
            if (choice.cost && gameState.player.gold >= choice.cost) {
                gameState.player.gold -= choice.cost;
                if (choice.effect) {
                    if (choice.effect.strength) gameState.player.strength += choice.effect.strength;
                    if (choice.effect.magic) gameState.player.magic += choice.effect.magic;
                    if (choice.effect.hp) gameState.player.hp = Math.min(gameState.player.maxHp, gameState.player.hp + choice.effect.hp);
                    if (choice.effect.item) gameState.player.inventory.push(choice.effect.item);
                }
                updateUI();
                showScene(gameState.currentRoom);
                return;
            }
            if (choice.next) {
                gameState.currentRoom = choice.next;
                showScene(gameState.currentRoom);
            }
        }

        // üî• –§–ò–ö–° –ë–û–Ø - –ü–û–õ–ù–ê–Ø –û–ß–ò–°–¢–ö–ê –¢–ê–ô–ú–ê–£–¢–û–í
        function startBattle(enemyName, enemyHp, enemyStr, reward) {
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –í–°–ï –ø—Ä–æ—Ü–µ—Å—Å—ã
            gameState.isBattling = true;
            gameState.battleEnemy = { name: enemyName, hp: enemyHp, maxHp: enemyHp, strength: enemyStr, reward };
            
            // –û—á–∏—â–∞–µ–º –≤—Å–µ —Ç–∞–π–º–∞—É—Ç—ã
            clearTimeout(gameState.typingTimeout);
            gameState.battleTimeouts.forEach(clearTimeout);
            gameState.battleTimeouts = [];
            
            document.getElementById('battle-log').style.display = 'block';
            document.getElementById('battle-log').className = 'battle-log';
            document.getElementById('battle-log').innerHTML = `<div>‚öîÔ∏è –ë–ò–¢–í–ê: ${gameState.player.name} VS ${enemyName}</div>`;
            document.getElementById('choices').innerHTML = '';
            
            performBattleRound();
        }

        function performBattleRound() {
            if (!gameState.isBattling || !gameState.battleEnemy) return;
            
            const log = document.getElementById('battle-log');
            
            // –ò–≥—Ä–æ–∫ –±—å–µ—Ç
            const playerDmg = Math.max(5, gameState.player.strength - Math.floor(Math.random() * 20));
            gameState.battleEnemy.hp -= playerDmg;
            log.innerHTML += `<div>‚öîÔ∏è ${gameState.player.name} –Ω–∞–Ω–µ—Å <span class="highlight">${playerDmg}</span> [${gameState.battleEnemy.hp}/${gameState.battleEnemy.maxHp}]</div>`;
            
            if (gameState.battleEnemy.hp <= 0) {
                log.innerHTML += `<div class="success">üéâ <span class="highlight">–ü–û–ë–ï–î–ê!</span></div>`;
                gameState.battleTimeouts.push(setTimeout(() => finishBattle(true), 2000));
                return;
            }
            
            // –í—Ä–∞–≥ –±—å–µ—Ç
            const enemyDmg = Math.max(3, gameState.battleEnemy.strength - Math.floor(Math.random() * 25));
            gameState.player.hp -= enemyDmg;
            log.innerHTML += `<div>üíÄ ${gameState.battleEnemy.name} –Ω–∞–Ω–µ—Å <span class="highlight">${enemyDmg}</span> [${gameState.player.hp}/${gameState.player.maxHp}]</div>`;
            
            if (gameState.player.hp <= 0) {
                log.innerHTML += `<div class="danger">üíÄ <span class="highlight">–ü–û–†–ê–ñ–ï–ù–ò–ï!</span></div>`;
                log.className = 'battle-log defeat';
                gameState.battleTimeouts.push(setTimeout(() => {
                    document.getElementById('choices').innerHTML = '<button class="choice-btn" onclick="location.reload()">üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>';
                }, 2000));
                gameState.isBattling = false;
                return;
            }
            
            gameState.battleTimeouts.push(setTimeout(performBattleRound, 1500));
        }

        function finishBattle(victory) {
            // –ü–û–õ–ù–ê–Ø –û–ß–ò–°–¢–ö–ê
            gameState.isBattling = false;
            gameState.battleEnemy = null;
            gameState.battleTimeouts.forEach(clearTimeout);
            gameState.battleTimeouts = [];
            
            if (victory) {
                const reward = gameState.battleEnemy?.reward || { gold: 50 };
                gameState.player.gold += reward.gold || 50;
                gameState.player.level = Math.floor(gameState.plotProgress / 3) + 1;
                if (reward.key) gameState.player.keys++;
                if (reward.amulet) gameState.player.hasAmulet = true;
                
                gameState.currentRoom = reward.nextRoom || 'courtyard';
                document.getElementById('battle-log').style.display = 'none';
                showScene(gameState.currentRoom);
            }
        }

        // –°–û–ö–†–ê–©–ï–ù–ù–´–ô –ú–ò–† (—á—Ç–æ–±—ã –∫–æ–¥ –Ω–µ –±—ã–ª –æ–≥—Ä–æ–º–Ω—ã–º)
        const gameWorld = {
            intro: {
                text: ["üåô –ù–æ—á—å 13-–≥–æ. –ì—Ä–æ–∑–∞ –Ω–∞–¥ –ü—Ä–æ–∫–ª—è—Ç—ã–º –ó–∞–º–∫–æ–º.", "–¢—ã ‚Äî –ù–∞—Å–ª–µ–¥–Ω–∏–∫ –¢–µ–Ω–µ–≥–æ–π. –û—Ç–µ—Ü –ø—Ä–æ–ø–∞–ª –∑–¥–µ—Å—å 13 –ª–µ—Ç –Ω–∞–∑–∞–¥.", "–í–µ—Ç–µ—Ä —à–µ–ø—á–µ—Ç: '–ö—Ä–æ–≤—å –∑–æ–≤–µ—Ç –∫—Ä–æ–≤—å...'"],
                choices: [
                    {text: "‚öîÔ∏è –í–æ—Ä–≤–∞—Ç—å—Å—è —Å –±–æ–µ–º", next: 'hallway_bold'},
                    {text: "üïØÔ∏è –û—Å—Ç–æ—Ä–æ–∂–Ω–æ –≤–æ–π—Ç–∏", next: 'hallway_cautious'},
                    {text: "üõí –ú–∞–≥–∞–∑–∏–Ω", next: 'shop'}
                ]
            },
            hallway_bold: {
                text: ["‚öîÔ∏è –¢—ã –≤—Ä—ã–≤–∞–µ—à—å—Å—è –≤ –≥–ª–∞–≤–Ω—ã–π –∑–∞–ª!", "üíÄ –¢—Ä–∏ —Å–∫–µ–ª–µ—Ç–∞-—Å—Ç—Ä–∞–∂–∞ –æ–∂–∏–≤–∞—é—Ç!"],
                onEnter: () => startBattle('–°–∫–µ–ª–µ—Ç—ã-—Å—Ç—Ä–∞–∂–∏', 90, 18, {gold: 80, nextRoom: 'hallway_victory'}),
                choices: []
            },
            hallway_victory: {
                text: ["üèÜ –°–∫–µ–ª–µ—Ç—ã –ø–æ–≤–µ—Ä–∂–µ–Ω—ã! –ù–∞—Ö–æ–¥–∏—à—å –ö–ª—é—á —Å—Ç—Ä–∞–∂–∏!", "–î–≤–µ –¥–æ—Ä–æ–≥–∏ –≤–µ–¥—É—Ç –≥–ª—É–±–∂–µ..."],
                onEnter: () => { gameState.player.keys++; gameState.plotProgress = 1; },
                choices: [{text: "‚û°Ô∏è –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞", next: 'library'}, {text: "üî® –ö—É–∑–Ω–∏—Ü–∞", next: 'forge'}, {text: "üõí –ú–∞–≥–∞–∑–∏–Ω", next: 'shop'}]
            },
            library: {
                text: ["üìö –î—Ä–µ–≤–Ω—è—è –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞. –ü—Ä–∏–∑—Ä–∞—á–Ω—ã–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä—å –æ—Ö—Ä–∞–Ω—è–µ—Ç –°–≤–∏—Ç–æ–∫ –ø—Ä–æ—Ä–æ—á–µ—Å—Ç–≤!"],
                choices: [{text: "‚öîÔ∏è –°—Ä–∞–∑–∏—Ç—å—Å—è —Å –ø—Ä–∏–∑—Ä–∞–∫–æ–º", next: 'ghost_fight'}, {text: "üîô –ù–∞–∑–∞–¥", next: 'hallway_victory'}]
            },
            ghost_fight: {
                text: ["üëª –ü—Ä–∏–∑—Ä–∞–∫ —Ä–µ–≤—ë—Ç! –ù—É–∂–Ω–∞ –º–∞–≥–∏—è!"],
                onEnter: () => startBattle('–ü—Ä–∏–∑—Ä–∞–∫', 110, 22, {gold: 120, nextRoom: 'library_victory'}),
                choices: []
            },
            library_victory: {
                text: ["üèÜ –ü—Ä–∏–∑—Ä–∞–∫ –∏–∑–≥–Ω–∞–Ω! –ß–∏—Ç–∞–µ—à—å –ü—Ä–æ—Ä–æ—á–µ—Å—Ç–≤–æ:", "'–¢—Ä–∏ –ö–ª—é—á–∞ + –ê–º—É–ª–µ—Ç –æ—Ç–∫—Ä–æ—é—Ç –ø—É—Ç—å –∫ –ß–µ—Ä–Ω–æ–º—É —Ç—Ä–æ–Ω—É...'"],
                onEnter: () => { gameState.plotProgress = 3; gameState.player.magic += 15; },
                choices: [{text: "‚û°Ô∏è –ê–ª—Ç–∞—Ä–Ω–∞—è", next: 'altar'}, {text: "üîô –ù–∞–∑–∞–¥", next: 'hallway_victory'}]
            },
            forge: {
                text: ["üî® –ö—É–∑–Ω–∏—Ü–∞ –î–≤–∞—Ä—Ñ–æ–≤. –û–≥—Ä-–∫—É–∑–Ω–µ—Ü –æ—Ö—Ä–∞–Ω—è–µ—Ç –†—É–Ω–Ω—ã–π –º–æ–ª–æ—Ç!"],
                choices: [{text: "‚öîÔ∏è –°—Ä–∞–∑–∏—Ç—å—Å—è —Å –æ–≥—Ä–æ–º", next: 'ogre_fight'}, {text: "üîô –ù–∞–∑–∞–¥", next: 'hallway_victory'}]
            },
            ogre_fight: {
                text: ["üëπ –û–≥—Ä-–∫—É–∑–Ω–µ—Ü –±–µ—Å–∏—Ç—Å—è!"],
                onEnter: () => startBattle('–û–≥—Ä-–∫—É–∑–Ω–µ—Ü', 140, 28, {gold: 150, nextRoom: 'forge_victory'}),
                choices: []
            },
            altar: {
                text: ["‚õ™ –ó–∞–ø—Ä–µ—Ç–Ω–∞—è –ê–ª—Ç–∞—Ä–Ω–∞—è. –ù—É–∂–µ–Ω –ö–ª—é—á —Å—Ç—Ä–∞–∂–∏!"],
                choices: [
                    {text: "üîë –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∞–ª—Ç–∞—Ä—å", condition: () => gameState.player.keys >= 1, next: 'altar_active'},
                    {text: "üîô –ù–∞–∑–∞–¥", next: 'library_victory'}
                ]
            },
            altar_active: {
                text: ["‚ú® –ê–ª—Ç–∞—Ä—å –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! –ü–æ–ª—É—á–∞–µ—à—å –ê–º—É–ª–µ—Ç –ü—Ä–µ–¥–∫–æ–≤!", "üíé +50 –∫–æ –≤—Å–µ–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º!"],
                onEnter: () => { 
                    gameState.player.hasAmulet = true; 
                    gameState.player.strength += 50; 
                    gameState.player.magic += 50; 
                    gameState.player.keys += 2;
                    gameState.plotProgress = 5;
                },
                choices: [{text: "‚û°Ô∏è –§–∏–Ω–∞–ª—å–Ω—ã–π —Ç—Ä–æ–Ω", next: 'final_chamber'}]
            },
            final_chamber: {
                text: ["üëë –ß–µ—Ä–Ω—ã–π –¢—Ä–æ–Ω. –§–∏–Ω–∞–ª—å–Ω—ã–π –ë–æ—Å—Å –∂–¥–µ—Ç!", `–ö–ª—é—á–∏: ${gameState.player.keys} | –ê–º—É–ª–µ—Ç: ${gameState.player.hasAmulet ? '‚úì' : '‚úó'}`],
                choices: [
                    {text: "‚öîÔ∏è –®—Ç—É—Ä–º–æ–≤–∞—Ç—å —Ç—Ä–æ–Ω", condition: () => gameState.player.keys >= 3 && gameState.player.hasAmulet, next: 'final_boss'},
                    {text: "üîô –ù–∞–∑–∞–¥", next: 'altar_active'}
                ]
            },
            final_boss: {
                text: ["‚ò†Ô∏è –ö–æ—Ä–æ–ª—å –õ–∏—á –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è! –≠–ü–ò–§–ê–ù–ò–Ø –ë–ò–¢–í–ê!"],
                onEnter: () => startBattle('–ö–æ—Ä–æ–ª—å –õ–∏—á', 300, 45, {gold: 1000, nextRoom: 'victory'}),
                choices: []
            },
            victory: {
                text: ["üéâ –õ–ï–ì–ï–ù–î–ê –°–û–í–ï–†–®–ï–ù–ê!", "–¢—ã –ø–æ–±–µ–¥–∏–ª –ö–æ—Ä–æ–ª—è –õ–∏—á–∞!", "–û—Ç–µ—Ü —Å–ø–∞—Å–µ–Ω. –¢—ã ‚Äî –Ω–æ–≤—ã–π –ö–æ—Ä–æ–ª—å!"],
                choices: [{text: "üèÜ –ù–æ–≤–∞—è –∏–≥—Ä–∞", next: 'intro'}]
            },
            shop: {
                text: ["üõí –¢–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –¢–æ—Ä–≥–æ–≤–µ—Ü:", "üíé –í—ã–±–µ—Ä–∏ —Å—É–¥—å–±—É, –≥–µ—Ä–æ–π..."],
                choices: [
                    {text: "üó°Ô∏è –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –∫–ª–∏–Ω–æ–∫ (250 –∑–æ–ª.)", next: 'shop', cost: 250, effect: {strength: 50, item: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –∫–ª–∏–Ω–æ–∫'}},
                    {text: "‚û°Ô∏è –í –∑–∞–º–æ–∫", next: 'intro'}
                ]
            }
        };

        updateUI();
        showScene('intro');
    </script>
</body>
</html>

